<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Mie Schede | FitSuite</title>
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="./lista_schede.css">
    <link rel="stylesheet" href="../templates/sidebar/sidebar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../components/loading_screen/loading_screen.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyCEgbB9rBBKOov3aDma0DMn-EuU0bGMMYo",
        authDomain: "fitsuite-a7b6c.firebaseapp.com",
        projectId: "fitsuite-a7b6c",
        storageBucket: "fitsuite-a7b6c.firebasestorage.app",
        messagingSenderId: "721614273457",
        appId: "1:721614273457:web:195f48279fafd01a1f5b90",
        measurementId: "G-W4ME455MH5"
      };
      firebase.initializeApp(firebaseConfig);
    </script>
    <!-- Logout script -->
    <script src="../../backend/function/logout.js"></script>
    <script src="../cache_manager.js"></script>
</head>
<body class="list-body">
    <script src="../components/loading_screen/loading_screen.js"></script>

    <div class="app-container">
        <!-- Sidebar -->
        <div id="sidebar-placeholder"></div>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>Le Mie Schede</h1>
                <div class="search-wrapper">
                    <input type="text" id="search-bar" placeholder="Cerca schede...">
                    <i class="fas fa-search search-icon"></i>
                </div>
                <button class="logout-btn" id="logout-button">Logout</button>
            </header>

            <div class="routines-list-container">
                <div class="list-header">
                    <span class="col-menu"></span> <!-- Placeholder for alignment -->
                    <span class="col-name">Nome</span>
                    <span class="col-sessions">Sedute</span>
                    <span class="col-date">Periodo</span>
                    <span class="col-actions">Azioni</span>
                </div>
                <div class="routines-list" id="routines-container">
                    <!-- Le schede verranno caricate qui -->
                </div>
            </div>
        </main>
    </div>

    <script src="../templates/sidebar/sidebar.js"></script>
    <script src="./lista_schede.js"></script>
    <script>
        // Load sidebar.html into the sidebar-placeholder div
        fetch('../templates/sidebar/sidebar.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('sidebar-placeholder').innerHTML = html;
            })
            .catch(error => console.error('Error loading sidebar:', error));

        document.addEventListener('DOMContentLoaded', () => {
            const logoutButton = document.getElementById('logout-button');
            if (logoutButton) {
                logoutButton.addEventListener('click', async () => {
                    await logout();
                });
            }

            // Firebase Auth check
            const auth = firebase.auth();
            const loadingScreen = document.getElementById('loading-screen');

            auth.onAuthStateChanged(user => {
                if (!user) {
                    window.location.href = '../auth/auth.html';
                }
                // loadingScreen.style.display = 'none'; // Moved to lista_schede.js after data load
            });
        });
    </script>
</body>
</html>
